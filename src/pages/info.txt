  // üîê Protect route (only redirect AFTER mount)
  useEffect(() => {
    if (!totalAmount || !customer || !cartItems) {
      navigate("/shop");
    }
  }, [totalAmount, customer, cartItems, navigate]);

  if (!totalAmount || !customer || !cartItems) return null;


  import { Link, useNavigate, useLocation } from "react-router-dom"; import { Eye, EyeOff } from "lucide-react"; import { useState } from "react"; import { useAuth } from "../context/AuthContext"; export default function Login() { const navigate = useNavigate(); const location = useLocation(); const { login } = useAuth(); const [showPassword, setShowPassword] = useState(false); const [email, setEmail] = useState(""); const [emailError, setEmailError] = useState(""); const [password, setPassword] = useState(""); const [passwordError, setPasswordError] = useState(""); const state = location.state as any; // Redirect after login const from = state?.from || "/shop"; const validateEmail = (value: string) => { const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; if (!value) return (setEmailError("Email is required"), false); if (!emailRegex.test(value)) return (setEmailError("Invalid email address"), false); setEmailError(""); return true; }; const validatePassword = (value: string) => { if (!value) return (setPasswordError("Password is required"), false); setPasswordError(""); return true; }; const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); if (!validateEmail(email) || !validatePassword(password)) return; const API_URL = import.meta.env.VITE_API_URL; console.log("API_URL:", API_URL); try { const res = await fetch(${API_URL}/api/auth/login, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ email, password }), }); let data; try { data = await res.json(); } catch { throw new Error("Server did not return valid JSON"); } if (!res.ok) { throw new Error(data.message || "Login failed"); } login(data.user, data.token); if (data.user.role === "admin") { navigate("/admin/dashboard", { replace: true }); } else { navigate(from, { replace: true }); } } catch (err: any) { alert(err.message); } }; return ( <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-[#2b0057] to-[#2f1fff] px-4"> <div className="bg-white p-8 rounded-xl shadow-xl w-full max-w-md"> <h2 className="text-3xl font-bold text-center mb-6"> Login to Optenix </h2> <form className="space-y-4" onSubmit={handleSubmit}> {/* EMAIL */} <div> <input id="email" name="email" type="email" placeholder="Email address" value={email} autoComplete="email" onChange={(e) => { setEmail(e.target.value); validateEmail(e.target.value); }} className="w-full px-4 py-3 border rounded-lg" required /> {emailError && ( <p className="text-sm text-red-600 mt-1">{emailError}</p> )} </div> {/* PASSWORD */} <div> <div className="relative"> <input id="password" name="password" type={showPassword ? "text" : "password"} placeholder="Password" value={password} autoComplete="current-password" onChange={(e) => { setPassword(e.target.value); validatePassword(e.target.value); }} className="w-full px-4 py-3 border rounded-lg pr-12" required /> <button type="button" onClick={() => setShowPassword(!showPassword)} className="absolute inset-y-0 right-3 flex items-center" > {showPassword ? <EyeOff /> : <Eye />} </button> </div> {passwordError && ( <p className="text-sm text-red-600 mt-1">{passwordError}</p> )} </div> <button type="submit" className="w-full py-3 bg-gradient-to-r from-blue-600 to-cyan-500 text-white rounded-lg font-semibold" > Login </button> </form> <p className="text-center mt-4"> Don‚Äôt have an account?{" "} <Link to="/register" state={{ from }} className="text-blue-600 font-medium" > Register </Link> </p> </div> </div> ); } this is Login.tsx import { Link, useNavigate } from "react-router-dom"; import { Eye, EyeOff } from "lucide-react"; import { useState } from "react"; export default function Register() { const navigate = useNavigate(); console.log("ENV API URL =", import.meta.env.VITE_API_URL); const [name, setName] = useState(""); const [email, setEmail] = useState(""); const [password, setPassword] = useState(""); const [confirmPassword, setConfirmPassword] = useState(""); const [showPassword, setShowPassword] = useState(false); const [showConfirmPassword, setShowConfirmPassword] = useState(false); const [loading, setLoading] = useState(false); const API_URL = "http://localhost:5000"; const handleSubmit = async (e: React.FormEvent) => { e.preventDefault(); if (password !== confirmPassword) { alert("Passwords do not match"); return; } setLoading(true); try { const res = await fetch(${API_URL}/api/auth/register, { method: "POST", headers: { "Content-Type": "application/json", }, body: JSON.stringify({ name, email, password, }), }); // üîê SAFETY: handle non-JSON responses if (!res.ok) { const text = await res.text(); throw new Error(text || "Registration failed"); } alert("Registered successfully"); navigate("/login"); } catch (err: any) { alert(err.message || "Something went wrong"); } finally { setLoading(false); } }; return ( <div className="min-h-screen flex items-center justify-center bg-gray-100"> <div className="bg-white p-8 rounded-lg w-full max-w-md shadow"> <h2 className="text-2xl font-bold mb-6 text-center"> Register </h2> <form onSubmit={handleSubmit} className="space-y-4"> <input type="text" placeholder="Full Name" value={name} onChange={(e) => setName(e.target.value)} className="w-full p-3 border rounded" /> <input type="email" placeholder="Email" value={email} onChange={(e) => setEmail(e.target.value)} className="w-full p-3 border rounded" required /> <div className="relative"> <input type={showPassword ? "text" : "password"} placeholder="Password" value={password} onChange={(e) => setPassword(e.target.value)} className="w-full p-3 border rounded pr-12" required /> <button type="button" onClick={() => setShowPassword(!showPassword)} className="absolute right-3 top-3 text-gray-500" > {showPassword ? <EyeOff size={18} /> : <Eye size={18} />} </button> </div> <div className="relative"> <input type={showConfirmPassword ? "text" : "password"} placeholder="Confirm Password" value={confirmPassword} onChange={(e) => setConfirmPassword(e.target.value)} className="w-full p-3 border rounded pr-12" required /> <button type="button" onClick={() => setShowConfirmPassword(!showConfirmPassword)} className="absolute right-3 top-3 text-gray-500" > {showConfirmPassword ? <EyeOff size={18} /> : <Eye size={18} />} </button> </div> <button type="submit" disabled={loading} className={w-full py-3 rounded text-white ${ loading ? "bg-gray-400" : "bg-blue-600 hover:bg-blue-700" }} > {loading ? "Registering..." : "Register"} </button> </form> <p className="text-center mt-4"> Already have an account?{" "} <Link to="/login" className="text-blue-600"> Login </Link> </p> </div> </div> ); }